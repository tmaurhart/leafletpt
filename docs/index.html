<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Leaflet - Prototype</title>
    <meta name="author" content="Sascha Popp, Thomas Maurhart">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">

    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link href="manifest.webmanifest" rel="manifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#2b3e51">
    <meta name="msapplication-TileColor" content="#2b3e51">
    <meta name="theme-color" content="#2b3e51">
    
    <link href="css/leaflet.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">

    <script src="js/leaflet.js"></script>
    <script src="js/leaflet-tilelayer-wmts.js"></script>
    

</head>

<body>
    
    <div id="mapid"></div>
   
    <script>
        var mymap = L.map('mapid', {
            minZoom: 18,
            maxZoom: 18 
        }).setView([47.583896, 12.173329], 18);

        var ign = new L.tileLayer("https://{s}.wien.gv.at/basemap/bmaporthofoto30cm/normal/google3857/{z}/{y}/{x}.jpeg", {
            subdomains: ['maps', 'maps1', 'maps2', 'maps3', 'maps4'],
            attribution: '&copy; <a href="http://basemap.at">Basemap.at</a>, Sascha & Tom'
        });

        mymap.addLayer(ign);

        var marker = L.marker([47.583896, 12.173329]).addTo(mymap);
        
        /*
        navigator.geolocation.getCurrentPosition(function (location) {
            var latlng = new L.LatLng(location.coords.latitude, location.coords.longitude);
            var marker = new L.marker(latlng).addTo(mymap);
        });
        */

        function getLocation() {
                
            // Check whether browser supports Geolocation API or not
            if (navigator.geolocation) { // Supported
                watchID = navigator.geolocation.watchPosition(function(position) {
                    getPosition(position);
                });
                        
            } else { // Not supported
                alert("Oops! This browser does not support HTML Geolocation.");
            }
        }

        function getPosition(position) {           
            var latlng = new L.LatLng(position.coords.latitude, position.coords.longitude);
            mymap.setZoom(11);
            mymap.setView(latlng, 18);
            marker.setLatLng(latlng);        
            console.log(latlng);
        }
        
        function catchError(positionError) {
            switch (positionError.code) {
                case positionError.TIMEOUT:
                    alert("The request to get user location has aborted as it has taken too long.");
                    break;
                case positionError.POSITION_UNAVAILABLE:
                    alert("Location information is not available.");
                    break;
                case positionError.PERMISSION_DENIED:
                    alert("Permission to share location information has been denied!");
                    break;
                default:
                    alert("An unknown error occurred.");
            }
        }

        var customIcon = L.icon({
            iconUrl: 'images/custom-marker.png',
            shadowUrl: 'images/custom-marker-shadow.png',

            iconSize: [32, 37], // size of the icon
            shadowSize: [50, 64], // size of the shadow
            iconAnchor: [22, 94], // point of the icon which will correspond to marker's location
            shadowAnchor: [4, 62],  // the same for the shadow
            popupAnchor: [-3, -76] // point from which the popup should open relative to the iconAnchor
        });

        var locations = [
            ["LOCATION_1", 47.58415734, 12.17140172],
            ["LOCATION_2", 47.58354222, 12.1716553],
            ["LOCATION_3", 47.58342643, 12.17369378]
        ];

        for (var i = 0; i < locations.length; i++) {
            marker = new L.marker([locations[i][1], locations[i][2]], {
                icon: customIcon
            }).addTo(mymap);
        }

        function onLocationFound(e) {
            var radius = e.accuracy / 2;
            L.marker(e.latlng).addTo(mymap)
                .bindPopup("You are within " + radius + " meters from this point").openPopup();
            L.circle(e.latlng, radius).addTo(mymap);
        }

        mymap.on('locationfound', onLocationFound);
        mymap.locate({ setView: true, watch: true, maxZoom: 8 });

    </script>

</body>

</html>