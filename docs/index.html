<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Leaflet - Prototype</title>
    <meta name="author" content="Sascha Popp, Thomas Maurhart">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">

    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link href="manifest.webmanifest" rel="manifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#2b3e51">
    <meta name="msapplication-TileColor" content="#2b3e51">
    <meta name="theme-color" content="#2b3e51">
    
    <link href="css/leaflet.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">

    <script src="js/leaflet.js"></script>
    <script src="https://rawgithub.com/mylen/leaflet.TileLayer.WMTS/master/leaflet-tilelayer-wmts.js"></script>
    

</head>

<body onload="getLocation();">
    
    <div id="mapid"></div>
    <div id="debug"></div>
    
    <script>
        

        /*Geolocation.watchPosition().subscribe((position) => {
                this.x = position.coords.longitude;
                this.y = position.coords.latitude;*/

        //navigator.geolocation.getCurrentPosition(function (location) {
        
        /*    navigator.geolocation.watchPosition(function (location) {
            var mymap = new L.Map('mapid');
            mymap.setZoom(11);
            var latlng = new L.LatLng(location.coords.latitude, location.coords.longitude);

            var positionOptions = {
                timeout: Infinity,
                maximumAge: 0,
                enableHighAccuracy: true
            }

            //var mymap = L.map('mapid').setView(latlng, 13);
            mymap.setView(latlng, 18);

            



            var ign = new L.tileLayer("https://{s}.wien.gv.at/basemap/bmaporthofoto30cm/normal/google3857/{z}/{y}/{x}.jpeg", {
                subdomains: ['maps', 'maps1', 'maps2', 'maps3', 'maps4'],
                attribution: '&copy; <a href="http://basemap.at">Basemap.at</a>, Sascha & Tom',
                maxNativeZoom: 19,
                maxZoom: 18
            });

            mymap.addLayer(ign);

            var marker = L.marker(latlng).addTo(mymap);
        }, positionOptions);

*/

        function getLocation() {
                // Check whether browser supports Geolocation API or not
                if (navigator.geolocation) { // Supported

                    var positionOptions = {
                        timeout: Infinity,
                        maximumAge: 0,
                        enableHighAccuracy: true
                    }

                    navigator.geolocation.getCurrentPosition(getPosition, catchError, positionOptions);
                    // watchID = navigator.geolocation.watchPosition(getPosition, catchError, positionOptions);


                } else { // Not supported
                    alert("Oops! This browser does not support HTML Geolocation.");
                }
            }
            function getPosition(position) {
                
                var mymap = new L.Map('mapid');
                mymap.setView(position.coords.latitude, position.coords.longitude, 18);

                var ign = new L.tileLayer("https://{s}.wien.gv.at/basemap/bmaporthofoto30cm/normal/google3857/{z}/{y}/{x}.jpeg", {
                    subdomains: ['maps', 'maps1', 'maps2', 'maps3', 'maps4'],
                    attribution: '&copy; <a href="http://basemap.at">Basemap.at</a>, Sascha & Tom',
                    maxNativeZoom: 19,
                    maxZoom: 18
                });

                mymap.addLayer(ign);
                var marker = L.marker(latlng).addTo(mymap);
            }

            function catchError(positionError) {
                switch (positionError.code) {
                    case positionError.TIMEOUT:
                        alert("The request to get user location has aborted as it has taken too long.");
                        break;
                    case positionError.POSITION_UNAVAILABLE:
                        alert("Location information is not available.");
                        break;
                    case positionError.PERMISSION_DENIED:
                        alert("Permission to share location information has been denied!");
                        break;
                    default:
                        alert("An unknown error occurred.");
                }
            }



    </script>

</body>

</html>